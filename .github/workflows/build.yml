name: CI

on: 
   push:
      branches:
         # - "**"
         - "master"
env:
  Version: "0.2.0"

jobs:
  build:
    strategy:
      matrix:
        os: 
          - windows-latest
          - ubuntu-latest
          # - macos-latest
    name: ${{ matrix.os }}
    runs-on: ${{ matrix.os }}

    steps:
      - name: Checkout
        uses: actions/checkout@v3
        
      #- name: Checkout dawn
      #  uses: actions/checkout@v3
      #  with:
      #    repository: vmxy/dawn 
      #    #ref: bae8c688fe96d7fd07136d05b4a6931e9e6ead4d
      #    path: dawn

      - uses: actions/setup-node@v3
        with:
          node-version: '16.x'

      - name: install rs toolchain
        uses: actions-rs/toolchain@v1
        with:
          toolchain: nightly
          override: true
          default: true

      - name: install cargo com
        if: matrix.os == 'window-latestxxxx'
        run: |
          #curl -sSf https://static.rust-lang.org/rustup.sh | sh
          #curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
          #echo "export PATH:$PATH:$HOME/.cargo/bin"
          #source /etc/profile
         
          rustup component list
      
      - name: install cargo dep - window
        if: matrix.os == 'window-latest'
        run: |
          rustup toolchain remove stable-x86_64-pc-windows-msvc
          rustup install stable-x86_64-pc-windows-msvc

      - name: Build
        run: |
          # rustup install nightly
          rustup default stable
          cargo update ahash
          cargo build --release

      # upload
      - name: Upload build
        uses: actions/upload-artifact@v3
        with:
          name: generated-${{ matrix.os }}
          path: target/release

